<!DOCTYPE html>
<html>

<head>
    <title>Flight Tracker Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
</head>

<body>
    <div class="dashboard">
        <header class="top-bar">
            <h1>Flight Tracker</h1>
            <div class="stats">
                <span>Tracked Flights: <span id="flight-count">0</span></span>
                <span>Active Areas: <span id="area-count">0</span></span>
            </div>
        </header>
        <div class="main-content">
            <div class="map-container">
                <div id="map"></div>
                <div class="legend">
                    <div><span style="color: #808080;">⋯</span> Disabled Area</div>
                    <div><span style="color: #006400;">⋯</span> Monitored Area</div>
                    <div><span style="color: #00ff00;">■</span> Commercial</div>
                    <div><span style="color: #ff0000;">■</span> Survey</div>
                    <div><span style="color: #FFA500;">■</span> Agriculture</div>
                    <div><span style="color: #0000FF;">■</span> Cloud Seeding</div>
                </div>
            </div>
            <aside class="sidebar">
                <div class="controls">
                    <h2>Controls</h2>
                    <select id="frequency">
                        <option value="30s">30s</option>
                        <option value="1m">1m</option>
                        <option value="5m">5m</option>
                    </select>
                    <button id="monitor-btn" onclick="toggleMonitoring()">Start Monitoring</button>
                    <button id="delete-btn" onclick="deleteArea()" disabled>Delete Area</button>
                    <button id="retrain-btn" onclick="retrainModel()" disabled>Retrain Model</button>
                    <h3>Show Paths</h3>
                    <select id="path-classes" multiple size="4" onchange="updateFlightPaths()">
                        <option value="commercial" selected>Commercial</option>
                        <option value="survey">Survey</option>
                        <option value="agriculture">Agriculture</option>
                        <option value="cloud seeding">Cloud Seeding</option>
                    </select>
                    <div class="add-class">
                        <input type="text" id="new-class" placeholder="New classification">
                        <button onclick="addClassification()">Add</button>
                    </div>
                </div>
                <div class="flight-list">
                    <h2>Active Flights</h2>
                    <input type="text" id="flight-filter" placeholder="Filter flights..." onkeyup="filterFlights()">
                    <select id="class-filter" onchange="filterFlights()">
                        <option value="">All Classifications</option>
                        <option value="commercial">Commercial</option>
                        <option value="survey">Survey</option>
                        <option value="agriculture">Agriculture</option>
                        <option value="cloud seeding">Cloud Seeding</option>
                    </select>
                    <div id="flight-list-content"></div>
                </div>
            </aside>
        </div>
        <footer class="log-container">
            <h2>Logs</h2>
            <pre id="log"></pre>
        </footer>
    </div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script src="/static/js/simplify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/map_init.js"></script>
    <script src="/static/js/area_manager.js"></script>
    <script src="/static/js/flight_renderer.js"></script>
    <script src="/static/js/controls.js"></script>
    <script src="/static/js/socket.js"></script>
    <script>
        function addClassification() {
            const input = document.getElementById('new-class');
            const newClass = input.value.trim();
            if (newClass && !Array.from(document.getElementById('path-classes').options).some(opt => opt.value === newClass)) {
                const option = new Option(newClass, newClass);
                document.getElementById('path-classes').add(option);
                document.getElementById('class-filter').add(new Option(newClass, newClass));
                input.value = '';
                updateFlightPaths();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initMap();
            setupSocketEvents();
            updateFlightPaths();
            setInterval(updateFlightPaths, 10000);
        });
    </script>
</body>

</html>