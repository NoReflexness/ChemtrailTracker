<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Flight Pattern Analyzer</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css" />
</head>

<body>
    <div class="container">
        <h1>Flight Pattern Analyzer</h1>

        <div class="date-range-form">
            <h2>Define Monitoring Area</h2>
            <div id="mapid" style="height: 400px; width: 100%;"></div>
            <p id="area-info">Area: N/A kmÂ² | Credit Cost: N/A</p>
            <select id="refresh-rate">
                <option value="30">30 seconds</option>
                <option value="60">1 minute</option>
                <option value="300">5 minutes</option>
                <option value="600">10 minutes</option>
            </select>
            <button id="play-pause-btn" disabled>Play</button>
            <button id="stop-btn" disabled>Stop</button>
            <p id="credits-info">Credits Used: {{ initial_credits_used }} | Remaining: {{ CREDITS_PER_DAY -
                initial_credits_used }}</p>
            <p id="timer">Next Refresh: N/A</p>
            <p id="auth-message" style="display: none; color: #ff6b6b;"></p>
            <form id="analyze-form">
                <button type="submit">Analyze Stored Data</button>
            </form>
        </div>

        <div class="instructions">
            <h2>How to Use This Tool</h2>
            <p>Steps:</p>
            <ol>
                <li>Hold Shift and drag on the map to draw a rectangle defining the monitoring area (release Shift to
                    set).</li>
                <li>Select a refresh rate, then use "Play" to start/resume monitoring, "Pause" to pause, and "Stop" to
                    end it.</li>
                <li>Click "Analyze Stored Data" to process all collected states and view paths.</li>
            </ol>
            <p><strong>Note:</strong> Area size affects credit cost (1-4 credits/request, 4000/day limit).</p>
        </div>

        <div id="log-feed">
            <h2>Log Feed</h2>
            <pre id="log-output"></pre>
        </div>

        <div id="result" style="display: none;">
            <h2>Analysis Results</h2>
            <button id="retrain-btn">Retrain Model</button>
            <div id="flight-review"></div>
            <a id="download-link" href="/download_report" download="unusual_flights.csv">Download Report</a>
        </div>
    </div>

    <script>
        const savedBounds = {{ saved_bounds | tojson | safe }};
        const initialCreditsUsed = {{ initial_credits_used | tojson | safe }};
        const airplaneIconSvg = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                <path d="M22 16.21v-1.895L14 12V8a2 2 0 0 0-4 0v4L2 14.315v1.894l8-2.5v4l-2 1v1l4-1 4 1v-1l-2-1v-4l8 2.5z" fill="#000000"/>
            </svg>
        `;
    </script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>

</html>